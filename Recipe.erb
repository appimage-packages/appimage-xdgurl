#!/bin/bash
rm -rf /app || true # Clean up from previous runs
rm /out/* || true
mkdir -p /app/usr/bin /app/usr/share/applications/  /out

APP=<%= proper_name %>
LOWERAPP=<%= name %>

# Get helper functions
wget -q https://github.com/appimage-packages/AppImages/raw/master/functions.sh -O ./functions.sh
. ./functions.sh
rm -f functions.sh

function copy_desktop {
  find . -name *desktop -exec cp {} . \;
}

#get deps
yum -y install gnome-common perl-URI.noarch gnome-icon-theme python33  python26 wxPython wxGTK

git clone https://github.com/xdgurl/xdgurl
cd xdgurl
make -j 8
make install

VERSION=$(git describe | sed -e 's/-r.*$// ; s/^v// ')
ARCH=$(arch)
APP= <%= name %>

cp /usr/share/icons/gnome/scalable/emblems/emblem-web.svg . || true

# delete potentially harmful binaries
delete_blacklisted

#Copy libs over
copy_libs

#copy desktop in place
copy_desktop
echo Icon=emblem-web >>  /xdgurl.desktop
# Add desktop integration
get_desktopintegration <%= name %>

generate_appimage
